# UEBA Insider Threat Detection — Interactive Dashboard

## Overview

The dashboard is a **Streamlit** web application that provides a real-time, interactive interface for exploring insider-threat anomaly-detection results produced by the project's machine-learning pipeline. It visualises per-user anomaly scores, risk levels, behavioral feature breakdowns, and cross-channel risk indicators — giving an analyst a single pane of glass to monitor and investigate potential insider threats.

The application is located at [`dashboard/app.py`](app.py) and is designed with a dark, minimalist aesthetic using custom CSS, the **Inter** and **JetBrains Mono** font families, and **Plotly** charts styled to match.

---

## Prerequisites

| Requirement | Minimum Version |
|---|---|
| Python | 3.10+ |
| Streamlit | 1.54.0 |
| Pandas | 2.3.0 |
| NumPy | 2.4.0 |
| Plotly | 6.5.0 |
| PyArrow | 23.0.0 |

All dependencies are listed in the project root [`requirements.txt`](../requirements.txt). Install them with:

```bash
py -m pip install -r requirements.txt
```

> On macOS/Linux, replace `py` with `python3` (or `python`).

### Data Files (must be generated first)

The dashboard reads two data files that are created by earlier notebooks in the pipeline. **The dashboard will not start until these files exist.**

| File | Generated By | Description |
|---|---|---|
| `processed_datasets/ueba_dataset.csv` (or `.parquet`) | `CERT_Preprocessing.ipynb` | Feature-engineered UEBA dataset with daily user-level behavioral features |
| `static_dashboards/table_1.csv` (or `.parquet`) | `Static_Dashboard.ipynb` | Analyst table containing anomaly scores, percentile ranks, and risk levels per user-day |

Run the notebooks in this order before launching the dashboard:

1. **`CERT_Preprocessing.ipynb`** — preprocesses raw CERT data into the UEBA feature dataset.
2. **`Autoencoder.ipynb`** — trains the autoencoder used for latent embeddings.
3. **`Isolation_Forest.ipynb`** — runs the Isolation Forest on the embeddings to produce anomaly scores.
4. **`Static_Dashboard.ipynb`** — joins anomaly scores with the UEBA dataset and writes the analyst table.

> **Tip:** The dashboard automatically prefers `.parquet` files over `.csv` for 5–10× faster load times. If you convert the datasets to Parquet, place them alongside the CSVs with the same base name.

---

## How to Run

From the **project root** directory, run:

```bash
py -m streamlit run dashboard/app.py
```

Streamlit will open the dashboard in your default browser (usually at `http://localhost:8501`).

> **Note (Windows):** `py` is the [Python Launcher for Windows](https://docs.python.org/3/using/windows.html#python-launcher-for-windows) and is the most reliable way to invoke Python. On macOS/Linux, use `python3 -m streamlit run dashboard/app.py` instead.

### Common Options

| Flag | Example | Purpose |
|---|---|---|
| `--server.port` | `py -m streamlit run dashboard/app.py --server.port 8080` | Change the port |
| `--server.headless true` | Useful for remote / VM deployments | Suppress auto-open browser |
| `--theme.base dark` | Already set via CSS, but can be reinforced | Force dark theme |

---

## Dashboard Structure

The app is organised into **four tabs**, accessible from the top navigation bar, plus a **sidebar** for global filters.

### Sidebar — Global Filters

| Control | Description |
|---|---|
| **Date Range** | Restricts all tabs to the selected date window |
| **Risk Levels** | Multi-select to show only HIGH, MEDIUM, and/or LOW risk records |
| **Search User** | Free-text search to quickly jump to a user in the Investigation tab |

The sidebar also displays the **DSK (Data Structure Kittens)** team branding and project context.

---

### Tab 1 — Overview

A high-level executive summary of the monitored environment.

| Section | Visualisation | Details |
|---|---|---|
| **KPI Cards** (6) | HTML cards with colour-coded left borders | Users Monitored, High Risk count, Medium Risk count, Total Records, Avg Anomaly Score, Detection Rate |
| **Risk Distribution** | Donut chart (Plotly) | Proportion of records by risk level (HIGH / MEDIUM / LOW) |
| **Alert Trend Over Time** | Stacked area chart | Daily alert counts broken out by risk level |
| **Top 15 Riskiest Users** | Horizontal bar chart | Users ranked by max percentile rank, coloured by number of high-risk days |
| **Anomaly Score Distribution** | Overlaid histogram | Distribution of anomaly scores segmented by risk level |
| **Cross-Channel Risk Flags** | Metric cards | Global counts for USB + File Write, Off-Hours Activity, and External Communication flags |

---

### Tab 2 — Investigation

Deep-dive into a single user's behavior.

| Section | Visualisation | Details |
|---|---|---|
| **User Search / Select** | Text input + dropdown | Type a user ID to search; defaults to top 20 riskiest users |
| **User KPI Cards** (5) | Streamlit metrics | Overall Risk label, Peak Percentile, High-Risk Days, Medium-Risk Days, Days Observed |
| **Anomaly Score Timeline** | Line + scatter chart | Anomaly score over time with risk-level-coloured markers |
| **Behavioral Radar Chart** | Polar/spider chart | Average activity across four channels (Authentication, File Access, Removable Media, Email) compared to the population average |
| **Daily Feature Heatmap** | Heatmap (imshow) | Matrix of raw feature values per day for the selected user (last 30 days) |
| **Cross-Channel Risk Indicators** | Metric cards | Per-user counts for USB+File, Off-Hours, and External Comms flags |
| **Raw Activity Table** | Interactive dataframe | Full sortable table of all daily records for the user |

---

### Tab 3 — Alerts

A filterable, sortable alert feed for triage workflows.

| Section | Visualisation | Details |
|---|---|---|
| **Severity Filter** | Multi-select | Filter alerts by HIGH / MEDIUM / LOW |
| **Min Percentile Slider** | Slider | Only show alerts above a percentile threshold |
| **Max Rows** | Number input | Limit the number of rows returned |
| **Alert Table** | Interactive dataframe | Columns: User, Day, Risk Level, Anomaly Score, Percentile (progress bar), Cross-Channel Flags |
| **Export** | Download button | Export the current alert view as a `.csv` file |

---

### Tab 4 — Channels

Behavioral feature analysis across the four activity channels.

| Section | Visualisation | Details |
|---|---|---|
| **Channel Activity Volume** | Multi-line time series | Daily total volume for each channel over time |
| **Channel Volume Share** | Donut chart | Relative proportion of total events per channel |
| **Feature Distributions** | Box plots | Distribution of any selected feature, segmented by risk level |
| **Feature Correlation Matrix** | Heatmap | Pearson correlation matrix across all raw behavioral features |

---

### Footer — Data Gaps & Recommended Enhancements

An expandable section documenting features that are common in production UEBA systems but are not yet available in the CERT r6.2 dataset (e.g., user department/role, IP geolocation, data volume transferred, incident response workflows).

---

## How the Dashboard Was Built

### Technology Stack

| Layer | Technology |
|---|---|
| **Web framework** | [Streamlit](https://streamlit.io/) — Python-native app framework for data dashboards |
| **Charts** | [Plotly](https://plotly.com/python/) — interactive, browser-rendered charts (scatter, bar, pie, heatmap, radar, box, histogram, area) |
| **Data handling** | [Pandas](https://pandas.pydata.org/) + [PyArrow](https://arrow.apache.org/docs/python/) for efficient I/O and in-memory operations |
| **Styling** | Custom CSS injected via `st.markdown(unsafe_allow_html=True)` for a fully dark, monospaced, borderless design |

### Design Decisions

- **Caching:** `@st.cache_data` is used to load and merge the datasets once, so subsequent interactions do not re-read the files.
- **Memory efficiency:** Numeric columns are downcasted (`float64 → float32`, `int64 → int16/int32`) immediately after load to reduce memory footprint.
- **Rendering performance:** A `MAX_PLOT_POINTS = 50,000` cap is applied to histograms, box plots, and correlation matrices to keep browser rendering snappy. Data is sampled randomly when it exceeds this threshold.
- **Parquet preference:** The loader checks for `.parquet` files first, falling back to `.csv`. Parquet provides columnar compression and faster I/O.
- **Relative paths:** All file paths are resolved relative to the script's parent directory (`BASE_DIR`), so the app works from any working directory.
- **Responsive layout:** Custom CSS media queries adjust KPI card sizes, font sizes, and tab styling across large (>1400 px), medium (1024–1400 px), small (768–1023 px), and extra-small (<768 px) screens.

### Colour Palette

| Element | Colour | Hex |
|---|---|---|
| Background | Black | `#000000` |
| Card / panel background | Near-black | `#0a0a0a` |
| Borders | Dark grey | `#1a1a1a` |
| HIGH risk | Red | `#e84545` |
| MEDIUM risk | Gold | `#d4a017` |
| LOW risk | Steel blue | `#3a86a8` |
| Primary text | White | `#ffffff` |
| Secondary text | Grey | `#999999` / `#666666` |

---

## Behavioral Features Tracked

The dashboard visualises 17 raw behavioral features plus 3 cross-channel risk flags:

### Raw Features (per user per day)

| Channel | Features |
|---|---|
| **Authentication** | `logon_count`, `logoff_count`, `off_hours_logon` |
| **File Access** | `file_open_count`, `file_write_count`, `file_copy_count`, `file_delete_count`, `unique_files_accessed`, `off_hours_files_accessed` |
| **Removable Media** | `usb_insert_count`, `usb_remove_count`, `off_hours_usb_usage` |
| **Email** | `emails_sent`, `unique_recipients`, `external_emails`, `attachements_sent`, `off_hours_emails` |

### Cross-Channel Risk Flags

| Flag | Trigger Condition |
|---|---|
| `usb_file_activity_flag` | USB inserted **and** files written on the same day |
| `off_hours_activity_flag` | Activity detected outside normal business hours (9 AM – 5 PM) |
| `external_comm_activity_flag` | Emails sent to external (non-organisation) domains |

---

## Troubleshooting

| Problem | Solution |
|---|---|
| **"Data files not found"** error on launch | Run the four prerequisite notebooks in order (see [Data Files](#data-files-must-be-generated-first) above) |
| Dashboard loads slowly | Convert the CSV files to Parquet for 5–10× faster I/O. Place `.parquet` files next to the CSVs with the same base name |
| Charts are sluggish / browser freezes | Reduce the date range or filter to specific risk levels to lower the data volume sent to the browser |
| `streamlit` / `python` not recognized | Use `py -m streamlit run dashboard/app.py` on Windows. The `py` launcher is installed with Python and is always on PATH. On macOS/Linux use `python3` instead |
| Port 8501 in use | Use `--server.port <PORT>` to choose a different port |
| Streamlit version errors | Ensure `streamlit >= 1.54.0` is installed (`py -m pip install --upgrade streamlit`) |
